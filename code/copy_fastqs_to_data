#Copies PEG3350 project samples' sequence data files from miseq_runs folder in schloss-lab turbo storage to the Tomkovich_PEG3350_XXXX_2020 project directory, specifically data/raw. This script is a record of bash commands used, since it is just moving/renaming files there is no need to submit as a job. For each library, the water & mock fastqs will be renamed to match the motility project plate number they were in. After sequences from all libraries have been transferred to the project's raw data directory, we will remove the dashes of the sample names to make downstream analysis easier.

#After logging onto Great lakes go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 1-2
#Copy raw data files into CDI_clinical_samples directory for data analysis

#These plates were part of the library for plates 45-47 from the CDI clinical samples sequencing project. We only need some of the samples from plate 47 since plates 45-47 were all part of the CDI clinical samples sequencing project. Because this library is a mix of 2 sequencing projects, we need to be specific about the files we copy over (Only want samples that match M*D*.fastq.gz).
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Data/Intensities/BaseCalls/M*D*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Data/Intensities/BaseCalls/mock*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Data/Intensities/BaseCalls/water*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cd tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
#Remove the mock and waters for the first 2 plates of this library, as all of those samples were part of a different project.
rm mock1_*.gz
rm mock2_*.gz
rename 'mock3_' mock1_ *.gz
rename 'mock4_' mock2_ *.gz
rm water1_*.gz
rm water2_*.gz
rename 'water3_' water1_ *.gz
rename 'water4_' water2_ *.gz

#Rename the following files to reflect their unique_labels in the finalized metadata file. These 2 plates were planned before the unique_labels were finalized so updates need to be made to the WMR samples:
rename 'M5WMR5D6_' M5WMR5Dn4_ *.gz
rename 'M5WMR6D6_' M5WMR6Dn4_ *.gz
rename 'M5WMR7D6_' M5WMR7Dn4_ *.gz
rename 'M5WMR8D6_' M5WMR8Dn4_ *.gz
rename 'M5WMR9D6_' M5WMR9Dn4_ *.gz
rename 'M5WMR10D6_' M5WMR10Dn4_ *.gz
rename 'M5WMR5D11_' M5WMR5D1_ *.gz
rename 'M5WMR6D11_' M5WMR6D1_ *.gz
rename 'M5WMR7D11_' M5WMR7D1_ *.gz
rename 'M5WMR8D11_' M5WMR8D1_ *.gz
rename 'M5WMR9D11_' M5WMR9D1_ *.gz
rename 'M5WMR10D11_' M5WMR10D1_ *.gz
rename 'M5WMR5D14_' M5WMR5D4_ *.gz
rename 'M5WMR6D14_' M5WMR6D4_ *.gz
rename 'M5WMR7D14_' M5WMR7D4_ *.gz
rename 'M5WMR8D14_' M5WMR8D4_ *.gz
rename 'M5WMR9D14_' M5WMR9D4_ *.gz
rename 'M5WMR10D14_' M5WMR10D4_ *.gz
rename 'M5WMR5D20_' M5WMR5D10_ *.gz
rename 'M5WMR6D20_' M5WMR6D10_ *.gz
rename 'M5WMR7D20_' M5WMR7D10_ *.gz
rename 'M5WMR8D20_' M5WMR8D10_ *.gz
rename 'M5WMR9D20_' M5WMR9D10_ *.gz
rename 'M5WMR10D20_' M5WMR10D10_ *.gz
#Correct 2 samples that were swapped while putting samples into extraction plate, but were never updated on the miseq platemap. Make a temporary intermediate file name (temp_) so no files are overwritten during renaming steps.
rename 'M5C19D1_' temp_ *.gz
rename 'M4C19Dn5_' M5C19D1_ *.gz
rename 'temp_' M4C19Dn5_ *.gz
#Remove this sample, which was dropped from the study because the mouse turned out to be pregnant:
rm M8C18D4_*.gz

#go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 3-6:
cp miseq_runs/2020_runs/Motility_p3-p6/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cd tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/

#I made some changes to the sample sheet after Lucas had already started the run. Rename these 3 samples (from plate 5: positions A12, B10 and F4) to reflect the updates:
rename 'M9CWM19D1_' FMT1D4_ *.gz
rename 'M9CWM20D1_' FMT2D4_ *.gz
rename 'M9CWM24D6-V2_' M9CWM19D6_ *.gz
rm Undetermined*.fastq.gz

#Rename PBS & FMT gavage solution samples that have underscores and hyphens. Will need to correct these sample names after reading 16Sprep_PEG3350_metadata into R for analysis.
rename 'FMT-from-Motility-9_' FMTMotility9_ *.gz
rename 'PBS-Gavage-from-D4-Motility-9_' PBSD4Motility9_ *.gz

#go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 7-10:
cp miseq_runs/2020_runs/SarahMotility_p7-10/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cd tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
rm Undetermined*.fastq.gz

#go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 11-13:
#These plates were part of the library for plate 52 from the CDI clinical samples sequencing project. Because this library is a mix of 2 sequencing projects, we need to be specific about the files we copy over (Only want samples that match M*D*.fastq.gz).
cp miseq_runs/2020_runs/CDIp52_Motility11-13/M*D*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cp miseq_runs/2020_runs/CDIp52_Motility11-13/mock*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cp miseq_runs/2020_runs/CDIp52_Motility11-13/water*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
cd tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/

#Remove mock and water controls for plate 52 from the CDI clinical samples sequencing project.
rm mock52_*.gz
rm water52_*.gz

#go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Future libraries should be easier to transfer all .fastq.gzfiles in one go
cp miseq_runs/2020_runs/_________/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/
#Change into raw data directory
cd tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/

#Renaming steps that will apply to all files

#Change into raw data directory
cd tomkoset/CDI_clinical_samples/data/raw/

#Count the number of files before and after with this command:
ls -l | wc -l
#2375

#Remove sequence data files for the 39 samples that were contaminated on the EpMotion during library preparation. See code/utilities.R for further detail. Use regex patternmatching and a for loop to remove the files
#Note: if unsure about pattern matching, use -i which will ask for confirmation before removing files
# xargs -d"\n" rm # command executes rm line once for every line that is piped to it.


#Removed the files without the . in _.* pattern and accidentally removed 4 files that match the beginning of M5WMR5D1.
#Count the number of files after removing contaminated sequence data files:
ls -l | wc -l
#2289 files remaining
#Some samples that were sequenced twice were removed: 43 sets of sequences removed instead of 39.
#4 samples removed that shouldn't have been

#Once turbo space is restored copy over same fastqs from Ana's project:
cp anataylo/Tomkovich_PEG3350_XXXX_2020/data/raw/*.gz tomkoset/Tomkovich_PEG3350_XXXX_2020/data/raw/

Then remove the 39 pairs of contaminated sequence files with:

for filepattern in '^M3WM3Dn1_.*' '^M3C14D4_.*' '^M3C15D4_.*' '^M3C13D0_.*' '^M3WM3D2_.*' '^M3WMC4D2_.*' '^M3WMC6D3_.*' '^M3C13D3_.*' '^M3C15D5_.*' '^M4WMC12Dn5_.*' '^M4C18Dn1_.*' '^M4C19Dn1_.*' '^M4WMC16D0_.*' '^M4C18D0_.*' '^M4WMC15D3_.*' '^M4WMC16D3_.*' '^M4C21D3_.*' '^M4WM5D5_.*' '^M4WM6D5_.*' '^M4C18D5_.*' '^M4C19D5_.*' '^M4C20D5_.*' '^M5WMR7Dn10_.*' '^M5WMR8Dn10_.*' '^M5WM14Dn1_.*' '^M5WM16Dn1_.*' '^M5C18Dn1_.*' '^M5WM13D0_.*' '^M5WM16D0_.*' '^M5C17D0_.*' '^M5WMR9D0_.*' '^M5WMR10D0_.*' '^M5WMR5D1_.*' '^M5WM15D2_.*' '^M5C18D2_.*' '^M5C19D2_.*' '^M5WM11D3_.*' '^M5WM12D3_.*' '^M5WM13D3_.*'
do
    ls | grep $filepattern | xargs -d"\n" rm -i
done

#Count the number of files after removing contaminated sequence data files:
ls -l | wc -l
